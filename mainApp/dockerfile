FROM node:latest

WORKDIR /usr/src/app/
COPY app/. /usr/src/app/

ARG VITE_APP_API_URL
ARG VITE_APP_DATABASE_TYPE
ARG VITE_APP_DATABASE_HOST
ARG VITE_APP_DATABASE_USER
ARG VITE_APP_DATABASE_PASSWORD
ARG VITE_APP_DATABASE_NAME
ARG VITE_APP_ADMIN_USERNAME
ARG VITE_APP_ADMIN_PASSWORD
ARG VITE_APP_UPDATER_URL

# Konvertiere ARG in ENV, damit React sie erkennt
ENV VITE_APP_API_URL=$VITE_APP_API_URL
ENV VITE_APP_DATABASE_TYPE=$VITE_APP_DATABASE_TYPE
ENV VITE_APP_DATABASE_HOST=$VITE_APP_DATABASE_HOST
ENV VITE_APP_DATABASE_USER=$VITE_APP_DATABASE_USER
ENV VITE_APP_DATABASE_PASSWORD=$VITE_APP_DATABASE_PASSWORD
ENV VITE_APP_DATABASE_NAME=$VITE_APP_DATABASE_NAME
ENV VITE_APP_ADMIN_USERNAME=$VITE_APP_ADMIN_USERNAME
ENV VITE_APP_ADMIN_PASSWORD=$VITE_APP_ADMIN_PASSWORD
ENV VITE_APP_UPDATER_URL=$VITE_APP_UPDATER_URL

# Erstelle eine .env-Datei
RUN echo "VITE_APP_API_URL=$VITE_APP_API_URL" > .env && \
    echo "VITE_APP_DATABASE_TYPE=$VITE_APP_DATABASE_TYPE" >> .env && \
    echo "VITE_APP_DATABASE_HOST=$VITE_APP_DATABASE_HOST" >> .env && \
    echo "VITE_APP_DATABASE_USER=$VITE_APP_DATABASE_USER" >> .env && \
    echo "VITE_APP_DATABASE_PASSWORD=$VITE_APP_DATABASE_PASSWORD" >> .env && \
    echo "VITE_APP_DATABASE_NAME=$VITE_APP_DATABASE_NAME" >> .env && \
    echo "VITE_APP_ADMIN_USERNAME=$VITE_APP_ADMIN_USERNAME" >> .env && \
    echo "VITE_APP_ADMIN_PASSWORD=$VITE_APP_ADMIN_PASSWORD" >> .env && \
    echo "VITE_APP_UPDATER_URL=$VITE_APP_UPDATER_URL" >> .env

# Installiere Abh√§ngigkeiten und baue die App
RUN npm install --force
RUN npm install -g serve
RUN npm run build

ENTRYPOINT serve -s dist